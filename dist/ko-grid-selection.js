/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function t(h,p){return function(h,k,l){function q(c){var e=window.document.createElement("input");e.className="ko-grid-selection-element";e.type=c?"checkbox":"radio";e.tabIndex=-1;return e}l.defineExtension("ko-grid-selection",{Constructor:function(c,e,b){function h(){r?(f={},g([])):b.data.source.streamValues(function(a){return a.filteredBy(b.data.predicate)}).then(function(a){return a.reduce(function(a,d){d=b.data.valueSelector(d[m]);a.o.push(d);a.predicate[d]=!0;return a},{o:[],predicate:{}})}).then(function(a){f=
a.predicate;g(a.o)})}function l(a,c,d){a=b.data.observableValueSelector(k.unwrap(d[m]));n||(f={},g().length=0);f[a]?(delete f[a],g.remove(a)):(f[a]=!0,g.push(a))}var n=!(!c.allowMultiSelection&&!e.allowMultiSelection);e=!(!c.evaluateRowClicks&&!e.evaluateRowClicks);var g=c.selectedEntriesIds||k.observableArray([]),p=c.selectedEntryId||k.observable(null);c=c.cellDoubleClick;var r=!1,u=b.columns.add({key:"selection",label:"",width:b.layout.determineCellDimensions(q(n)).width+"px"}),v=b.headers.forColumn(u),
f={},m=b.primaryKey;u.overrideValueBinding(function(){return{init:function(a){a.appendChild(q(n))},update:function(a,c,d){g();a.firstChild.checked=!!f[b.data.valueSelector(d[m])]}}});var w=v.element.subscribe(function(a){if(n&&a){var b=q(!0);a.appendChild(b);a.addEventListener("click",function(b){b.target===a&&(b.preventDefault(),h())})}});b.headers.onColumnHeaderClick(".ko-grid-selection-element",function(a){a.preventApplicationButAllowBrowserDefault();h()});if(e)b.data.onCellClick(l);else b.data.onCellClick(".ko-grid-selection-element",
l);if(c)b.data.onCellDoubleClick(c);b.data.rows.installClassifier(function(a){g();return f[b.data.observableValueSelector(k.unwrap(a[m]))]?["selected"]:[]});var x=k.computed(function(){var a=g().length;0==a&&(f={});var c=b.data.view.filteredSize();p(a?g()[a-1]:null);r=!!a&&a===c;var d=v.element();if(d=d&&d.querySelector(".ko-grid-selection-element"))d.checked=r,d.indeterminate=a>c});this.dispose=function(){w.dispose();x.dispose()}}});return l.declareExtensionAlias("selection","ko-grid-selection")}({},
p,h)}"function"===typeof define&&define.amd?define(["ko-grid","knockout","ko-data-source","ko-indexed-repeat"],t):window["ko-grid-selection"]=t(window.ko.bindingHandlers.grid,window.ko);